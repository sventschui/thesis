\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{hwz}[2018/11/15 HWZ Latex class]

%#############################
% Color all the things!
%#############################
% This needs to stay up here to prevent option clash warning
\usepackage[table]{xcolor}
 
%#############################
% Base class
%#############################
% font-size as in "Richtlinien Semesterarbeit"
\LoadClass[12pt, twoside]{extarticle}

%#############################
% Plumbing...
%#############################
\usepackage[utf8]{inputenc}
\usepackage[german]{babel}
\usepackage{hyperref} % adds clickable refs to citations & stuff

%#############################
% TODO Notes
%#############################
\definecolor{todocolor}{HTML}{CCCCCC}
\usepackage[color=todocolor]{todonotes}

%#############################
% Merge list of figures and list of tables
%#############################
\def\table{\def\figurename{Tabelle}\figure}
\let\endtable\endfigure 

%#############################
% Page layout
%#############################
% - Set margin analogous to word template
\usepackage[left=2.5cm, right=2.5cm, top=2.5cm, bottom=2cm]{geometry}

% - line-height as in "Richtilinien Semesterarbeit"
\renewcommand{\baselinestretch}{1.15}

% - custom paragraph spacing
\setlength{\parskip}{0.35em}

%#############################
% Page header & footer
%#############################
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\sectionmark}[1]{\markboth{#1}{}}
\renewcommand{\subsectionmark}[1]{\markright{#1}}
\setlength{\headheight}{15pt}
\fancyhf{}
\fancyfoot[LE,RO]{\thepage}

\fancypagestyle{plain}{%
  \fancyhf{}%
  \fancyfoot[LE,RO]{\thepage}%
  \renewcommand{\headrulewidth}{0pt}%
}

% clear page means CLEAR (no header & footer)
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
    \hbox{}
    \thispagestyle{plain}
    \newpage
    \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother

%#############################
% citation style APA
%#############################
% apacite uses bibtex and conforms mostly to APA 6th edition
% see https://tex.stackexchange.com/a/263800 on why we use biblatex-apa instead
%usepackage{apacite}
%bibliographystyle{apacite}
\usepackage[backend=biber, style=apa]{biblatex}
% References imported from mendeley WED to overleaf are missing urldate property and @online is added as @misc 
% \bibliography{./references.bib}
% Using library.bib generated by mendeley DESKTOP instead
% Be careful, this yields different IDs
\bibliography{./library.bib}
\usepackage{csquotes}
\DeclareLanguageMapping{german}{german-apa}

% spacing between bib entries
\setlength\bibitemsep{0.17\baselineskip}

% fix mendeley url messup
\DeclareSourcemap{ % Used when .bib/Bibliography is compiled, not when document is
    \maps{
        \map{ % Replaces '{\_}', '{_}' or '\_' with just '_'
            \step[fieldsource=url,
                  match=\regexp{\{\\\_\}|\{\_\}|\\\_},
                  replace=\regexp{\_}]
        }
        \map{ % Replaces '{'$\sim$'}', '$\sim$' or '{~}' with just '~'
            \step[fieldsource=url,
                  match=\regexp{\{\$\\sim\$\}|\{\~\}|\$\\sim\$},
                  replace=\regexp{\~}]
        }
    }
}

%#############################
% Graphics & Figures
%#############################
% allow for align in \includegraphics
\usepackage{graphbox}
% allow for float H
\usepackage{float}

% charts 
% \usepackage{pgfplots}
% \pgfplotsset{compat=1.13}

% floating figures/tables
\usepackage{wrapfig}

% tikz
% \usepackage{tikz}
% \usetikzlibrary{positioning} % for right=of ... syntax
% \usetikzlibrary{shapes.geometric, arrows}

% tikz styles
% \tikzstyle{process} = [rectangle, minimum width=3cm, minimum height=1cm, text centered, draw=igloo-darker, fill=igloo!50]
% \tikzstyle{process2} = [rectangle, minimum width=3cm, minimum height=1cm, text centered, draw=igloo-darker, fill=igloo]
% \tikzstyle{arrow} = [thick,->,>=stealth]

%#############################
% Headings
%#############################
% TODO: Format as in Lara's Thesis, this looks cool :)
\usepackage{titlesec}
\usepackage[T1]{fontenc}

% \titlespacing*{\section}{0pt}{*130}{50pt}

% \newcommand{\sectionbreak}{\clearpage\vspace{30pt}}

\definecolor{coloraaa}{HTML}{AAAAAA}
\newcommand{\hsp}{\hspace{20pt}}
\newcommand{\vsp}{\vspace{200pt}}
\titleformat{\section}[hang]{\LARGE\bfseries}{\thesection\hsp\textcolor{coloraaa}{|}\hsp}{0pt}{\LARGE\bfseries}
% \titleformat{\subsection}[hang]{\LARGE\bfseries}{\thesection}{0pt}{\Large\bfseries}
% This command would work but still has ugly page header
\newcommand{\mysection}[1]{
    % \thispagestyle{plain}
    \newpage
    % \vspace*{100pt}
    \section{#1}
    % \vspace{40pt}
}

%#############################
% Paragraphs
%#############################
\usepackage{parskip}

%#############################
% List
%#############################
% allows for custom list spacings
\usepackage{enumitem}

%#############################
% Colors
%#############################
\input{colors.tex}

%#############################
% Footnotes
%#############################
\usepackage[bottom]{footmisc}

%#############################
% Tables
%#############################
% make tables colored, because who doesn't love colors? :)
\usepackage{colortbl}

%#############################
% Captions
%#############################
% Allows the use of \caption* to prevent the caption from being numbered
\usepackage{caption}

%#############################
% Keep paragraphs together
%#############################
\widowpenalties 1 10000
\raggedbottom

%#############################
% Commands
%#############################
\input{commands/abstract.tex}
\input{commands/begin-main.tex}
\input{commands/bibliography.tex}
\input{commands/blankpage.tex}
\input{commands/declaration-of-authorship.tex}
\input{commands/list-of-tables-and-figures.tex}
\input{commands/preface.tex}
\input{commands/section-unnumbered.tex}
\input{commands/titlepage.tex}